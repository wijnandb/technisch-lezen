<html>
<head>
    <title>Tafels oefenen</title>
</head>
<body>

    <output id="result"></output>
    <a href="test.html">Nieuwe som</a>
<script type='text/javascript'>
// startup code
var numberA = getRandomNumber();
var numberB = getRandomNumber();
var text = 'Hoeveel is ' + numberA + ' keer ' + numberB + '?';
var response;

speechSynthesis.cancel();
var objSpeak = new SpeechSynthesisUtterance();

// ask the problem
ask(text, function (err, result) {
    if (err) {
        document.getElementById('result').innerHTML = 'Geen antwoord.';
    } else {
        var answer = parseInt(result.transcript);
       console.log('resultaat:' + numberA + ' - ' + numberB + ' - ' + answer + ' - ' + result.transcript);
        if (answer == numberA * numberB) {
            response = 'Goed! ' + numberA + ' x ' + numberB + ' is ' + answer + '.';
//            speak(response);
            document.getElementById('result').innerHTML = response;
        } else {
            response = 'Fout! ' + numberA + ' x ' + numberB + ' is niet ' + answer + ' maar ' + response + '.';
//            speak(response);
            document.getElementById('result').innerHTML = response;
        }
    }
})

// get random number between 1 - 10
function getRandomNumber() {
    return Math.floor((Math.random() * 10) + 1);
}


// ask a question and get an answer
function ask(text, callback) {
    // ask question
    speak(text, function () {
        // get answer
        var recognition = new webkitSpeechRecognition();
        recognition.lang = "nl-NL";
        recognition.continuous = false;
        recognition.interimResults = true;

        recognition.onend = function (e) {
            if (callback) {
                callback('no results');
            }
        };

        recognition.onresult = function (e) {
            // cancel onend handler
            recognition.onend = null;
            if (callback) {
                callback(null, {
                    transcript: e.results[0][0].transcript,
                    confidence: e.results[0][0].confidence
                });
            }
        }
        // start listening
        recognition.start();
    });
}


// say a message
function speak(text, callback) {
    objSpeak.text = text;
    objSpeak.lang = 'nl-NL';

    objSpeak.onstart = function (e) {
    };

    objSpeak.onend = function (e) {
        if (callback) {
            callback();
        }
    };

    objSpeak.onerror = function (e) {
        if (callback) {
            callback(e);
        }
    };
    speechSynthesis.speak(objSpeak);
}
</script>
</body>
</html>
